<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .container {
            margin-top: 60px;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            transition: color 0.3s ease-in-out;
        }

        .close-button:hover {
            color: red;
        }
    </style>
</head>

<body>
    <div class="container shadow rounded p-4 pb-5">
        <div class="card w-100 bg-secondary text-white">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div
                    class="bg-secondary text-white fs-4 fw-bold px-2 d-flex justify-content-between align-items-center w-100">
                    ‡∏´‡πâ‡∏≠‡∏á <%= (Array.isArray(data) && data.length> 0) ? data[0].room_id : 'N/A' %>
                        <button class="close-button" onclick="window.location.href='/bills';">
                            <i class="fas fa-times"></i>
                        </button>
                </div>
            </div>
        </div>

        <div class="card border-0">
            <div class="card-body d-flex justify-content-between align-items-center mt-4">
                <h5 class="mb-0 fs-4 fw-bold">‡∏ö‡∏¥‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</h5>
                <div>
                    <button class="btn btn-warning me-2" data-bs-toggle="modal" data-bs-target="#addExpenseModal">üìÑ
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    <button class="btn btn-primary me-2" data-bs-toggle="modal"
                        data-bs-target="#addRentWaterElectModal">
                        ‚ö° ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü
                    </button>
                    <button class="btn btn-success">ü™ô‡∏™‡πà‡∏á‡∏ö‡∏¥‡∏•</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <p class="fs-5 fw-bold mb-2"><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏¥‡∏•</strong></p>
                <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤: <%= data.length> 0 ? data[0].tenantFirstName + ' ' + data[0].tenantLastName : 'N/A' %>
                </p>
                <p>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: <%= data.length> 0 ? data[0].telephone : 'N/A' %></p>

                <table class="table table-bordered">
                    <thead>
                        <tr class="table-light">
                            <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</td>
                            <td id="rentFeeDisplay"><span class="fw-bold text-primary">
                                <%= data.length> 0 ? data[0].rent_fee : '0' %>
                            </span></td>
                        </tr>
                        <tr>
                            <td>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥</td>
                            <td id="waterBillDisplay">
                                <%= data.length> 0 ? data[0].water_bill : '0' %> ‡∏ö‡∏≤‡∏ó
                            </td>
                        </tr>
                        <tr>
                            <td>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</td>
                            <td id="electricityBillDisplay">
                                <%= data.length> 0 ? data[0].electricity_bill : '0' %> ‡∏ö‡∏≤‡∏ó
                            </td>
                        </tr>
                        
                        

                        <tr>
                            <td>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</td>
                            <td>
                                <%= data.length> 0 ? data[0].additional_expenses : '0' %>
                            </td>
                        </tr>
                        <tr class="table-secondary">
                            <td><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></td>
                            <td><strong>
                                    <%= data.length> 0 ? data[0].totalAmount : '0' %>
                                </strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Include Popup -->
    <%- include('popup_additional', { bill_id: data.length> 0 ? data[0].bill_id : 'N/A' }) %><%-
            include('popup_additional', { bill_id: data.length> 0 ? data[0].bill_id : 'N/A',
            room_id: data.length > 0 ? data[0].room_id : 'N/A'
            }) %>

            <%- include('popup_rent_water_elect_bill', { bill_id: data.length> 0 ? data[0].bill_id : 'N/A',
                room_id: data.length > 0 ? data[0].room_id : 'N/A'
                }) %>
                <script>
                    function saveExpense() {
                        let detail = document.getElementById("expenseDetail").value;
                        let amount = document.getElementById("expenseAmount").value;

                        if (!detail || amount <= 0) {
                            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0");
                            return;
                        }

                        let expenseData = {
                            detail: detail,
                            amount: parseFloat(amount),
                            bill_id: "<%= data.length > 0 ? data[0].bill_id : '' %>"
                        };

                        fetch('/api/add-expense', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(expenseData)
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                                    window.location.reload();
                                } else {
                                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + data.message);
                                }
                            })
                            .catch(error => console.error('Error:', error));
                    }

                </script>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>